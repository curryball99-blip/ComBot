{"ast":null,"code":"import{useCallback,useEffect,useState}from'react';// Simple Recent Activity component restored from legacy implementation\n// Uses new backend endpoints: /api/jira/recent and GET /api/jira/search\n// Will attempt /api/jira/recent first (fast path) and fall back to /api/jira/search if filters/customJql applied.\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const STATUS_COLOR_MAP={Open:'#2563eb','In Progress':'#9333ea','In Review':'#6366f1',Testing:'#f59e0b',Paused:'#64748b',Done:'#16a34a',Closed:'#16a34a',Resolved:'#16a34a'};const priorityColor=p=>{if(!p)return'#64748b';const v=p.toLowerCase();if(v.includes('high')||v.includes('block'))return'#dc2626';if(v.includes('med'))return'#d97706';return'#64748b';};// Derive API base (reuse logic pattern from api.js minimal version)\nconst getApiBase=()=>{try{if(process.env.REACT_APP_API_URL&&process.env.REACT_APP_API_URL.trim()){return process.env.REACT_APP_API_URL.replace(/\\/$/,'');}const{protocol,hostname}=window.location;const isLocal=['localhost','127.0.0.1'].includes(hostname);if(isLocal)return'http://localhost:8000';return\"\".concat(protocol,\"//\").concat(hostname,\":8000\");}catch(_unused){return'http://localhost:8000';}};const API_BASE=getApiBase();export const RecentActivity=_ref=>{let{projectKey='MBSL3',limit=15,autoRefreshMs=60000,compact=false,status,priority,assignee,customJql,quickFilter// matches backend quick_filter param (ACTIVE_MBSL3, RECENT_UPDATES, HIGH_PRIORITY)\n}=_ref;const[tickets,setTickets]=useState([]);const[loading,setLoading]=useState(false);const[err,setErr]=useState(null);const[lastUpdated,setLastUpdated]=useState(null);const buildParams=()=>{const params=new URLSearchParams();params.set('max_results',String(limit));if(customJql){params.set('custom_jql',customJql);return params;}if(status)params.set('status',status);if(priority)params.set('priority',priority);if(assignee)params.set('assignee',assignee);// Provide a base query for project scoping if not using customJql\nparams.set('query',\"project = \\\"\".concat(projectKey,\"\\\" ORDER BY updated DESC\"));return params;};const fetchTickets=useCallback(async()=>{setLoading(true);setErr(null);try{let list=[];// Fast path: no filters -> use /api/jira/recent\nif(!customJql&&!status&&!priority&&!assignee){const recentParams=new URLSearchParams();recentParams.set('project_key',projectKey);recentParams.set('limit',String(limit));if(quickFilter&&quickFilter!=='ALL'){recentParams.set('quick_filter',quickFilter);}const recent=await fetch(\"\".concat(API_BASE,\"/api/jira/recent?\").concat(recentParams.toString()));if(recent.ok){const data=await recent.json();list=(data.tickets||[]).slice(0,limit);}else{const txt=await recent.text();console.warn('Recent endpoint error',recent.status,txt);}}// Fallback or filtered path\nif(list.length===0||customJql||status||priority||assignee){const params=buildParams();const res=await fetch(\"\".concat(API_BASE,\"/api/jira/search?\").concat(params.toString()));if(!res.ok){const txt=await res.text();throw new Error(\"HTTP \".concat(res.status,\" \").concat(txt.slice(0,160)));}const data=await res.json();list=(data.tickets||[]).slice(0,limit);}setTickets(list);setLastUpdated(new Date().toLocaleTimeString());}catch(e){setErr(e.message||'Failed to load recent activity');}finally{setLoading(false);}},[projectKey,limit,customJql,status,priority,assignee,quickFilter]);useEffect(()=>{fetchTickets();const id=setInterval(fetchTickets,autoRefreshMs);return()=>clearInterval(id);},[fetchTickets,autoRefreshMs]);return/*#__PURE__*/_jsxs(\"div\",{style:{background:'#fff',border:'1px solid #e5e7eb',borderRadius:12,padding:16},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:12},children:[/*#__PURE__*/_jsx(\"h3\",{style:{margin:0,fontSize:16,fontWeight:600},children:\"Recent Activity\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:12,color:'#64748b'},children:loading?'Refreshing...':lastUpdated?\"Updated \".concat(lastUpdated):''})]}),err&&/*#__PURE__*/_jsx(\"div\",{style:{background:'#fef2f2',color:'#b91c1c',padding:'8px 10px',borderRadius:6,fontSize:12},children:err}),!loading&&tickets.length===0&&!err&&/*#__PURE__*/_jsx(\"div\",{style:{fontSize:13,color:'#64748b',padding:'8px 4px'},children:\"No recent tickets found.\"}),/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',flexDirection:'column',gap:8,maxHeight:compact?320:540,overflowY:'auto'},children:tickets.map(t=>{const statusColor=STATUS_COLOR_MAP[t.status||'']||'#475569';return/*#__PURE__*/_jsxs(\"div\",{style:{border:'1px solid #f1f5f9',borderRadius:10,padding:'10px 12px',background:'#f8fafc',display:'flex',flexDirection:'column',gap:4},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:8,flexWrap:'wrap'},children:[/*#__PURE__*/_jsx(\"a\",{href:t.url||\"https://your-domain.atlassian.net/browse/\".concat(t.key),target:\"_blank\",rel:\"noopener noreferrer\",style:{fontWeight:600,fontSize:13,color:'#1d4ed8',textDecoration:'none'},children:t.key}),t.status&&/*#__PURE__*/_jsx(\"span\",{style:{background:statusColor,color:'#fff',fontSize:11,padding:'2px 8px',borderRadius:999},children:t.status}),t.issueType&&/*#__PURE__*/_jsx(\"span\",{style:{background:'#e2e8f0',color:'#334155',fontSize:11,padding:'2px 8px',borderRadius:999},children:t.issueType}),t.priority&&/*#__PURE__*/_jsx(\"span\",{style:{background:priorityColor(t.priority),color:'#fff',fontSize:11,padding:'2px 8px',borderRadius:999},children:t.priority}),t.assignee&&t.assignee!=='Unassigned'&&/*#__PURE__*/_jsxs(\"span\",{style:{fontSize:11,color:'#475569'},children:[\"\\u2022 \",t.assignee]})]}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:13,color:'#0f172a',lineHeight:1.3},children:t.summary||'(No summary)'}),t.updated&&/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:11,color:'#64748b'},children:[\"Updated: \",new Date(t.updated).toLocaleString()]})]},t.key);})}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:10,display:'flex',gap:8},children:/*#__PURE__*/_jsx(\"button\",{onClick:fetchTickets,style:{background:'#2563eb',color:'#fff',border:'none',padding:'6px 12px',fontSize:12,borderRadius:6,cursor:'pointer'},disabled:loading,children:loading?'Refreshing...':'Refresh'})})]});};export default RecentActivity;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}